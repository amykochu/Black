{% extends 'base.html' %}
{% load static %}
{% block content %}
        	<div class="row">
		        <div class="col-xl-6	 col-sm-8 mb-3">
		          <div class="text-dark bg-white h-100">
							<form action="" method="post" class="listing" enctype="multipart/form-data">
							    {% csrf_token %}
								{% if opportunity %}
								<h4 class="heading-h1">Fund Seeker Opportunity Upload</h4>
								{% elif mandate %}
								<h4 class="heading-h1">Investor Mandate Upload</h4>
								{% endif %}
								<label class="required">Compulsory fields marked with</label>
							    {{ form.as_p }}
								{% if opportunity %}
								<label style="width: 100%">High Level Financial's</label>
								{% include 'financial_table.html' %}
								{% endif %}
                  <div style="width: 100%;float: left;">
                     <input type="submit" value="Upload">
                  </div>
							</form>
						</div>

				</div>

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.css">      
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.js"></script>
  <script>

function loadCountry(geographyId, country_selected){
      var url = '/ajax/load-geography/';  // get the url of the `load_cities` view

      $.ajax({                       // initialize an AJAX request
        url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'geography': geographyId       // add the country id to the GET parameters
        },
        success: function (response) {   // `data` is the return of the `load_cities` view function
        <!--$("#id_country").empty();-->




		  $("#id_country").append(`<optgroup label=${response.continent}> ${response.continent} </optgroup>`)
		  for(var i=0;i<response.data.length;i++){
		  $("#id_country").append(
		  `<option value= ${response.data[i]['id']} country_name= ${response.data[i]['country']} > ${response.data[i]['country']} </option>
		  </optgroup>`);

 		  }

        }
      });
}




function loadSector(sectorId, sector_selected){
      var url = '/ajax/load-sector/';  // get the url of the `load_cities` view

      $.ajax({                       // initialize an AJAX request
        url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'sector': sectorId       // add the country id to the GET parameters
        },
        success: function (response) {   // `data` is the return of the `load_cities` view function




		  $("#id_sub_sector").append(`<optgroup label=${response.sector}> ${response.sector} </optgroup>`)
		  for(var i=0;i<response.data.length;i++){
		  $("#id_sub_sector").append(
		  `<option value= ${response.data[i]['id']} sub_sector_name= ${response.data[i]['sub_sector']} > ${response.data[i]['sub_sector']} </option>
		  </optgroup>`);

 		  }

        }
      });
}



  $("#id_country").empty();
  $("#id_sub_sector").empty();


    $("#id_geography").change(function () {
          $("#id_country").find("option").remove()
          $("#id_country").find("optgroup").remove()
	  var country_selected = $("option:selected:last",this).text();
      var geographyId = $(this).val();  // get the selected country ID from the HTML input
	  var index = geographyId.indexOf('0');
	  if (index > -1) {
 		geographyId.splice(index, 1);
	  }
	  console.log(geographyId)
      for (i=0; i<geographyId.length; i++){
          loadCountry(geographyId[i], country_selected)
      }
	});

	$("#id_country").change(function () {
	  if($(this).val()=='') {
	    $("#id_country option").prop("selected", "selected");
	  }
	});


    $("#id_sector").change(function () {
          $("#id_sub_sector").find("option").remove()
          $("#id_sub_sector").find("optgroup").remove()
	  var sector_selected = $("option:selected:last",this).text();
      var sectorId = $(this).val();  // get the selected country ID from the HTML input
      var index = sectorId.indexOf('0')
      if (index > -1) {
        sectorId.splice(index, 1);
      }
	  console.log(sectorId)
      for (i=0; i<sectorId.length; i++){
          loadSector(sectorId[i], sector_selected)
      }
	});


	$("#id_sub_sector").change(function () {
	  if($(this).val()=='') {
	    $("#id_sub_sector option").prop("selected", "selected");
	  }
	});

    <!--$("#id_sector").change(function () {-->
      <!--var url = '/ajax/load-sector/';  // get the url of the `load_cities` view-->
      <!--var sectorId = $(this).val();  // get the selected country ID from the HTML input-->
      <!--$.ajax({                       // initialize an AJAX request-->
        <!--url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)-->
        <!--data: {-->
          <!--'sector': sectorId       // add the country id to the GET parameters-->
        <!--},-->
        <!--success: function (response) {   // `data` is the return of the `load_cities` view function-->
        <!--$("#id_sub_sector").empty();-->
 		  <!--for(var i=0;i<response.data.length;i++){-->
 		  <!--$("#id_sub_sector").append('<option value=' + response.data[i]['id'] + '>' + response.data[i]['sub_sector'] + '</option>');-->
 		  <!--}-->
        <!--}-->
      <!--});-->
    <!--});-->
  </script>

<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.4/js/standalone/selectize.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.4/css/selectize.css"/> -->
<!-- <script type="text/javascript">
  $('select').selectize({
plugins: ['remove_button']
});
  $(document).ready(function()
  {
    $("#id_country").parent("p").addClass("country");
    $("#id_geography").change(function()
    {
      // $(".listing .country .selectize-control").remove();
      // $("#id_country").removeClass("selectized").removeAttr("style");
      $("#id_country").selectize()[0].selectize.destroy();
      setTimeout(function()
      {
        $("#id_country").selectize({
        plugins: ['remove_button']
        });
      },1000);
    });

      $("#id_sub_sector").parent("p").addClass("sub_sector");
    $("#id_sector").change(function()
    {
      // $(".listing .sub_sector .selectize-control").remove();
      // $("#id_sub_sector").removeClass("selectized").removeAttr("style");
      // // $(".listing .sub_sector").html(`<label for="id_sub_sector-selectized">Sub Sector:</label><select name="country" required="" id="id_sub_sector" multiple="multiple"></select>`)
      $("#id_sub_sector").selectize()[0].selectize.destroy();
      setTimeout(function()
      {
        $("#id_sub_sector").selectize({
        plugins: ['remove_button']
        });
      },1000);
    });

    //  $("#id_sector").change(function()
    // {
    //   $(".listing p:nth-child(9) .selectize-control").remove();
    //   $("#id_sub_sector").removeClass("selectized").removeAttr("style").removeAttr("tabindex").html();
    //   $(".listing p:nth-child(9)").html(`<label for="id_sub_sector-selectized">Sub Sector:</label><select name="country" required="" id="id_sub_sector" multiple="multiple"></select>`)
    //   setTimeout(function()
    //   {
    //     $("#id_sub_sector").selectize({
    //     plugins: ['remove_button']
    //     });
    //   },100);
    // });
    //    $("#id_geography").change(function()
    // {
    //   $(".listing p:nth-child(7) .selectize-control").remove();
    //   $("#id_country").removeClass("selectized").removeAttr("style").removeAttr("tabindex").html();
    //   $(".listing p:nth-child(7)").html(`<label for="id_country">Country:</label><select name="country" required="" id="id_country" multiple="multiple"></select>`)
    //   setTimeout(function()
    //   {
    //     $("#id_country").selectize({
    //     plugins: ['remove_button']
    //     });
    //   },100);
    // });

  });
</script> -->
<link rel="stylesheet" href="{% static '/listing/css/bootstrap-multiselect.css' %}">
            <script type="text/javascript" src="{% static '/listing/js/bootstrap-multiselect.js' %}"></script>
            <script type="text/javascript">
$(document).ready(function() {
  var date = new Date();
  date.setDate(date.getDate());
  $('#id_deadline_commitment').datepicker({
    <!--format: 'yyyy-mm-dd',-->
      startDate: date
  });
  $('#id_deadline_legal').datepicker({
    <!--format: 'yyyy-mm-dd',-->
      startDate: date
  });
$('select').multiselect({
  includeSelectAllOption: true,
  selectAllValue: '0',
  nonSelectedText: '---------',});
});

 $("#id_country").parent("p").addClass("country");
 $("#id_sub_sector").parent("p").addClass("sub_sector");
    $("#id_geography").change(function()
    {
      setTimeout(function()
      {
        $("#id_country").multiselect('rebuild',
        {

         });
      },1000);

   });
    $("#id_sector").change(function()
    {
      setTimeout(function()
      {
         $("#id_sub_sector").multiselect('rebuild');
      },1000);
    });
</script>
{% endblock %}

